<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<script type="text/javascript"
    src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <link href="http://gmpg.org/xfn/11" rel="profile">
  
  <title>
    Clustering &middot; 
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans:300,400italic,400,600,700|Abril+Fatface">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.png">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


   <body>

    <header class="masthead">
      <div class="masthead-inner">
        <h1><a href = "/">R&sup2</a></h1>
        <p class="lead" style = "color:#cccccc">A personal blog about my fumblings with statistics, finance and anything  R</p>

        <div>
          <hr style="height:1px;border:none;color:#ffffff;background-color:#ffffff;"/>
          <a href="https://github.com/royr2/royr2.github.io" style="color:#ff00bf" target="_blank"><img style = "float:left; padding: 5px" src = "http://tinyurl.com/kpfzp6d" height = 50 width = 50></img></a>
          <a href="http://www.linkedin.com/in/riddhimanr" style="color:#00a7ff"><img style = "padding: 5px" src = "http://tinyurl.com/nk3b8sc" height = 50 width = 50></img></a>

          <p style = "color:#cccccc">Built using <a href = "http://jekyllrb.com"> jekyll </a> and <a href = "http://andhyde.com/"> hyde</a></p>
        </div>
	  </div>
    </header>

    <div class="content container">
      <div class="post">
  <h1>Clustering</h1>
  <span class="post-date">10 Jun 2014</span>
  <p>Here’s an example of how one could use 3d plots and some clustering to make some inferences from available data. I am using a set of financial indicators available on <a href="https://research.stlouisfed.org/fred2/]"><strong>FRED</strong></a>. You can download it <a href="https://github.com/royr2/royr2.github.io/tree/master/assets/downloads"><strong>here</strong></a>. I wanted to compare two different time periods using this data:</p>

<ul>
  <li>The dot com bubble</li>
  <li>The housing bubble</li>
</ul>

<p>Let’s first install and load all the packages we need.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#Install Packages 
#install.packages(c("zoo", "RColorBrewer", "rgl","quantmod","ggplot2"))
</span><span class="n">options</span><span class="p">(</span><span class="n">warn</span><span class="o">=</span><span class="m">-1</span><span class="p">)</span>
<span class="c1">#Load Packages 
</span><span class="n">library</span><span class="p">(</span><span class="n">class</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">zoo</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">RColorBrewer</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">rgl</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">quantmod</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span></code></pre></figure>

<p>Next let’s load in the dataset we want to work with.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#Clean the workspace
</span><span class="n">rm</span><span class="p">(</span><span class="n">list</span><span class="o">=</span><span class="n">ls</span><span class="p">())</span>

<span class="c1">#Load Data
</span><span class="n">dat</span> <span class="o">=</span> <span class="n">read.table</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s2">"financial_indicators.txt"</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="n">T</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s2">"\t"</span><span class="p">)</span></code></pre></figure>

<p>Let’s look at the data first.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#Set some colors
</span><span class="n">cols</span><span class="o">=</span><span class="n">brewer.pal</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="m">8</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s2">"Set1"</span><span class="p">)</span>

<span class="c1">#Convert to zoo object
</span><span class="n">dat</span> <span class="o">=</span> <span class="n">zoo</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">dat</span><span class="p">[,</span><span class="m">-1</span><span class="p">],</span><span class="n">order.by</span><span class="o">=</span><span class="n">as.Date</span><span class="p">(</span><span class="n">dat</span><span class="p">[,</span><span class="m">1</span><span class="p">],</span><span class="n">format</span><span class="o">=</span><span class="s2">"%Y-%m-%d"</span><span class="p">))</span>

<span class="c1">#Print the first few rows 
</span><span class="n">head</span><span class="p">(</span><span class="n">dat</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">##            CANDH CFNAI CFNAIDIFF CFNAIMA3 EUANDH KCFSI PANDI SOANDI
## 1967-03-01 -0.04 -0.49        NA       NA  -0.06    NA -0.37  -0.02
## 1967-04-01 -0.01 -0.15        NA       NA  -0.23    NA  0.21  -0.11
## 1967-05-01 -0.06 -0.65     -0.22    -0.43   0.11    NA -0.60  -0.10
## 1967-06-01  0.07 -0.02     -0.20    -0.27   0.10    NA -0.15  -0.03
## 1967-07-01 -0.07 -0.34     -0.25    -0.33   0.19    NA -0.28  -0.18
## 1967-08-01 -0.01  1.49      0.13     0.38   0.41    NA  0.81   0.28
##            UMCSENT USSLIND
## 1967-03-01      NA      NA
## 1967-04-01      NA      NA
## 1967-05-01      NA      NA
## 1967-06-01      NA      NA
## 1967-07-01      NA      NA
## 1967-08-01      NA      NA</code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#Plot the data set
</span><span class="n">plot</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="n">main</span><span class="o">=</span><span class="s2">"Financial Indicators"</span><span class="p">,</span><span class="n">xlab</span><span class="o">=</span><span class="s2">"Time"</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">cols</span><span class="p">,</span><span class="n">lwd</span><span class="o">=</span><span class="m">1</span><span class="p">)</span></code></pre></figure>

<p><img src="/assets/figures/Clustering/unnamed-chunk-3-1.png" title="center" alt="center" style="display: block; margin: auto;" /></p>

<p>I have got 10 different financial indicators. Let’s reduce the number of dimensions using some principal component analysis.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#PCA Decomposition
</span><span class="n">pca</span> <span class="o">=</span> <span class="n">princomp</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">na.omit</span><span class="p">(</span><span class="n">dat</span><span class="p">),</span><span class="n">cor</span><span class="o">=</span><span class="n">T</span><span class="p">,</span><span class="n">scores</span><span class="o">=</span><span class="n">T</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">pca</span><span class="p">,</span><span class="n">type</span><span class="o">=</span><span class="s2">"lines"</span><span class="p">)</span></code></pre></figure>

<p><img src="/assets/figures/Clustering/unnamed-chunk-4-1.png" title="center" alt="center" style="display: block; margin: auto;" /></p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#Take the first three components
</span><span class="n">mat</span> <span class="o">=</span> <span class="n">pca</span><span class="o">$</span><span class="n">scores</span><span class="p">[,</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">]</span></code></pre></figure>

<p>I took the first three principal components since it’ll be easier to make plots in 3 dimensions.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">plot3d</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">cols</span><span class="p">[</span><span class="m">1</span><span class="p">],</span><span class="n">size</span><span class="o">=</span><span class="m">10</span><span class="p">,</span><span class="n">type</span><span class="o">=</span><span class="s1">'p'</span><span class="p">)</span>

<span class="err">#</span><span class="n">Note</span> <span class="n">that</span> <span class="n">the</span> <span class="n">command</span> <span class="n">will</span> <span class="n">create</span> <span class="n">a</span> <span class="n">separate</span> <span class="n">plot</span> <span class="n">window</span> <span class="n">you</span> <span class="n">can</span> <span class="n">interact</span> <span class="n">with.</span></code></pre></figure>

<p><img src="/assets/figures/Clustering/Base.png" title="center" alt="center" style="display: block; margin: auto;" /></p>

<p>Let’s add some time overlays to this plot. Let’s look at recession dates +- 1 year.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#2007 / 2008 Recession
#Recession Start Date
</span><span class="n">t1</span> <span class="o">=</span> <span class="s2">"2006-12-01"</span>

<span class="c1">#Recession End Date
</span><span class="n">t2</span> <span class="o">=</span> <span class="s2">"2010-06-01"</span>
  
<span class="n">idx</span> <span class="o">=</span> <span class="n">rownames</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span><span class="o">&gt;=</span><span class="n">t1</span> <span class="o">&amp;</span> <span class="n">rownames</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">t2</span>
<span class="n">mat.rec</span> <span class="o">=</span> <span class="n">mat</span><span class="p">[</span><span class="n">idx</span><span class="p">,]</span>

<span class="c1">#Base Plot
</span><span class="n">plot3d</span><span class="p">(</span><span class="n">mat</span><span class="p">[,</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">],</span><span class="n">col</span><span class="o">=</span><span class="n">cols</span><span class="p">[</span><span class="m">2</span><span class="p">],</span><span class="n">size</span><span class="o">=</span><span class="m">10</span><span class="p">,</span><span class="n">type</span><span class="o">=</span><span class="s1">'p'</span><span class="p">,</span><span class="n">main</span><span class="o">=</span><span class="s2">"2007/08 Recession (in Black)"</span><span class="p">)</span>

<span class="c1">#Time Overlay
</span><span class="n">plot3d</span><span class="p">(</span><span class="n">mat.rec</span><span class="p">[,</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">],</span><span class="n">col</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="n">type</span><span class="o">=</span><span class="s1">'s'</span><span class="p">,</span><span class="n">add</span><span class="o">=</span><span class="n">T</span><span class="p">)</span></code></pre></figure>

<p>The plot looks something like this (recession in black)</p>

<p><img src="/assets/figures/Clustering/Rec 1.png" title="center" alt="center" style="display: block; margin: auto;" /></p>

<p>In comparision, the dot com bubble looks like this:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#Dot Com Bubble
#Start Date
</span><span class="n">t1</span> <span class="o">=</span> <span class="s2">"2000-03-01"</span>

<span class="c1">#End Date
</span><span class="n">t2</span> <span class="o">=</span> <span class="s2">"2002-11-01"</span>

<span class="n">idx</span> <span class="o">=</span> <span class="n">rownames</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span><span class="o">&gt;=</span><span class="n">t1</span> <span class="o">&amp;</span> <span class="n">rownames</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">t2</span>
<span class="n">mat.rec</span> <span class="o">=</span> <span class="n">mat</span><span class="p">[</span><span class="n">idx</span><span class="p">,]</span>

<span class="c1">#Base Plot
</span><span class="n">plot3d</span><span class="p">(</span><span class="n">mat</span><span class="p">[,</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">],</span><span class="n">col</span><span class="o">=</span><span class="n">cols</span><span class="p">[</span><span class="m">3</span><span class="p">],</span><span class="n">size</span><span class="o">=</span><span class="m">10</span><span class="p">,</span><span class="n">type</span><span class="o">=</span><span class="s1">'p'</span><span class="p">)</span>

<span class="c1">#Time Overlay
</span><span class="n">plot3d</span><span class="p">(</span><span class="n">mat.rec</span><span class="p">[,</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">],</span><span class="n">col</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="n">type</span><span class="o">=</span><span class="s1">'s'</span><span class="p">,</span><span class="n">add</span><span class="o">=</span><span class="n">T</span><span class="p">)</span></code></pre></figure>

<p><img src="/assets/figures/Clustering/Rec 2.png" title="center" alt="center" style="display: block; margin: auto;" /></p>

<p>The same financial indicators seem to be behaving very differently during the two economic recessions. This seems to support the fact the the dot com bubble and the housing bubble were very different in nature. <a href="http://conversableeconomist.blogspot.com/2011/10/why-didnt-dot-com-crash-hurt-like.html">See here</a></p>

<p>Lets use some k-means clustering to visualize this effect</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#K-Means clustering using 2 centers
</span><span class="n">clust</span> <span class="o">=</span> <span class="n">kmeans</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">mat</span><span class="p">,</span><span class="n">centers</span><span class="o">=</span><span class="m">2</span><span class="p">)</span>

<span class="c1">#Combine data with cluster and color information
</span><span class="n">mat</span> <span class="o">=</span> <span class="n">data.frame</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span><span class="n">cluster</span> <span class="o">=</span> <span class="n">as.factor</span><span class="p">(</span><span class="n">clust</span><span class="o">$</span><span class="n">cluster</span><span class="p">))</span>
<span class="n">mat</span> <span class="o">=</span> <span class="n">data.frame</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span><span class="n">cols</span> <span class="o">=</span> <span class="n">cols</span><span class="p">[</span><span class="n">as.factor</span><span class="p">(</span><span class="n">clust</span><span class="o">$</span><span class="n">cluster</span><span class="p">)])</span>

<span class="c1">#Plot
</span><span class="n">plot3d</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">mat</span><span class="p">[,</span><span class="s2">"cols"</span><span class="p">],</span><span class="n">size</span><span class="o">=</span><span class="m">10</span><span class="p">,</span><span class="n">type</span><span class="o">=</span><span class="s1">'p'</span><span class="p">)</span>
<span class="n">text3d</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">clust</span><span class="o">$</span><span class="n">centers</span><span class="p">[,</span><span class="m">1</span><span class="p">],</span><span class="n">y</span><span class="o">=</span><span class="n">clust</span><span class="o">$</span><span class="n">centers</span><span class="p">[,</span><span class="m">2</span><span class="p">],</span><span class="n">z</span><span class="o">=</span><span class="n">clust</span><span class="o">$</span><span class="n">centers</span><span class="p">[,</span><span class="m">3</span><span class="p">],</span><span class="n">texts</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="s2">"c1"</span><span class="p">,</span><span class="s2">"c2"</span><span class="p">,</span><span class="s2">"c3"</span><span class="p">),</span><span class="n">col</span><span class="o">=</span><span class="s2">"red"</span><span class="p">,</span><span class="n">cex</span><span class="o">=</span><span class="m">2</span><span class="p">)</span></code></pre></figure>

<p><img src="/assets/figures/Clustering/Cluster.png" title="center" alt="center" style="display: block; margin: auto;" /></p>

<p>Most of the points in the 07/08 recession seem to fall in cluster 1. Let’s compare the two in one single plot</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#Base Plot
</span><span class="n">plot3d</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="s2">"gray"</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="m">10</span><span class="p">,</span><span class="n">type</span><span class="o">=</span><span class="s1">'p'</span><span class="p">)</span>
<span class="n">text3d</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">clust</span><span class="o">$</span><span class="n">centers</span><span class="p">[,</span><span class="m">1</span><span class="p">],</span><span class="n">y</span><span class="o">=</span><span class="n">clust</span><span class="o">$</span><span class="n">centers</span><span class="p">[,</span><span class="m">2</span><span class="p">],</span><span class="n">z</span><span class="o">=</span><span class="n">clust</span><span class="o">$</span><span class="n">centers</span><span class="p">[,</span><span class="m">3</span><span class="p">],</span><span class="n">texts</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="s2">"c1"</span><span class="p">,</span><span class="s2">"c2"</span><span class="p">),</span><span class="n">col</span><span class="o">=</span><span class="s2">"red"</span><span class="p">,</span><span class="n">cex</span><span class="o">=</span><span class="m">2</span><span class="p">)</span>

<span class="c1">#Compare the two recessions
#Housing Bubble in RED
</span><span class="n">t1</span> <span class="o">=</span> <span class="s2">"2007-12-01"</span>
<span class="n">t2</span> <span class="o">=</span> <span class="s2">"2009-06-01"</span>
  
<span class="n">idx</span> <span class="o">=</span> <span class="n">rownames</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span><span class="o">&gt;=</span><span class="n">t1</span> <span class="o">&amp;</span> <span class="n">rownames</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">t2</span>
<span class="n">mat.rec</span> <span class="o">=</span> <span class="n">mat</span><span class="p">[</span><span class="n">idx</span><span class="p">,]</span>
<span class="n">plot3d</span><span class="p">(</span><span class="n">mat.rec</span><span class="p">[,</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">],</span><span class="n">col</span><span class="o">=</span><span class="n">cols</span><span class="p">[</span><span class="m">1</span><span class="p">],</span><span class="n">size</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="n">type</span><span class="o">=</span><span class="s1">'s'</span><span class="p">,</span><span class="n">add</span><span class="o">=</span><span class="n">T</span><span class="p">)</span>

<span class="c1">#Dot com bubble in BLUE
</span><span class="n">t1</span> <span class="o">=</span> <span class="s2">"1997-04-01"</span>
<span class="n">t2</span> <span class="o">=</span> <span class="s2">"2003-06-01"</span>
  
<span class="n">idx</span> <span class="o">=</span> <span class="n">rownames</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span><span class="o">&gt;=</span><span class="n">t1</span> <span class="o">&amp;</span> <span class="n">rownames</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">t2</span>
<span class="n">mat.rec</span> <span class="o">=</span> <span class="n">mat</span><span class="p">[</span><span class="n">idx</span><span class="p">,]</span>
<span class="n">plot3d</span><span class="p">(</span><span class="n">mat.rec</span><span class="p">[,</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">],</span><span class="n">col</span><span class="o">=</span><span class="n">cols</span><span class="p">[</span><span class="m">2</span><span class="p">],</span><span class="n">size</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="n">type</span><span class="o">=</span><span class="s1">'s'</span><span class="p">,</span><span class="n">add</span><span class="o">=</span><span class="n">T</span><span class="p">)</span></code></pre></figure>

<p>Note that the housing bubble data is in red and the dotcom bubble data in blue</p>

<p>Let’s also compare some common economic indicators. Let’s download some data from FRED.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#Get Data
</span><span class="n">getSymbols</span><span class="p">(</span><span class="n">Symbols</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="s2">"SPCS10RSA"</span><span class="p">,</span><span class="s2">"UNRATE"</span><span class="p">,</span><span class="s2">"GDPC1"</span><span class="p">,</span><span class="s2">"BAA10Y"</span><span class="p">),</span><span class="n">src</span><span class="o">=</span><span class="s2">"FRED"</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## [1] "SPCS10RSA" "UNRATE"    "GDPC1"     "BAA10Y"</code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#Merge
</span><span class="n">mat</span> <span class="o">=</span> <span class="n">merge</span><span class="p">(</span><span class="n">SPCS10RSA</span><span class="p">,</span><span class="n">UNRATE</span><span class="p">,</span><span class="n">GDPC1</span><span class="p">,</span><span class="n">BAA10Y</span><span class="p">)</span>
<span class="n">mat</span> <span class="o">=</span> <span class="n">mat</span><span class="p">[</span><span class="n">which</span><span class="p">(</span><span class="n">index</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span><span class="o">==</span><span class="s2">"1990-01-01"</span><span class="p">)</span><span class="o">:</span><span class="n">nrow</span><span class="p">(</span><span class="n">mat</span><span class="p">),]</span>

<span class="c1">#Convert to Quarterly
</span><span class="n">mat</span> <span class="o">=</span> <span class="n">aggregate</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">mat</span><span class="p">,</span><span class="n">by</span><span class="o">=</span><span class="n">as.yearqtr</span><span class="p">,</span><span class="n">FUN</span><span class="o">=</span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">){</span>
  <span class="n">round</span><span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">na.rm</span><span class="o">=</span><span class="n">T</span><span class="p">),</span><span class="m">2</span><span class="p">)</span>
<span class="p">})</span>

<span class="c1">#Get limits
</span><span class="n">xmin1</span> <span class="o">=</span> <span class="n">which</span><span class="p">(</span><span class="n">index</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span><span class="o">==</span><span class="s2">"2007 Q4"</span><span class="p">)</span>
<span class="n">xmax1</span> <span class="o">=</span> <span class="n">which</span><span class="p">(</span><span class="n">index</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span><span class="o">==</span><span class="s2">"2009 Q2"</span><span class="p">)</span>

<span class="n">xmin2</span> <span class="o">=</span> <span class="n">which</span><span class="p">(</span><span class="n">index</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span><span class="o">==</span><span class="s2">"2001 Q1"</span><span class="p">)</span>
<span class="n">xmax2</span> <span class="o">=</span> <span class="n">which</span><span class="p">(</span><span class="n">index</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span><span class="o">==</span><span class="s2">"2002 Q1"</span><span class="p">)</span>

<span class="n">ymin</span> <span class="o">=</span> <span class="o">-</span><span class="n">Inf</span>
<span class="n">ymax</span> <span class="o">=</span> <span class="n">Inf</span>

<span class="n">limits</span> <span class="o">=</span> <span class="n">data.frame</span><span class="p">(</span><span class="n">xmin1</span><span class="p">,</span><span class="n">xmax1</span><span class="p">,</span><span class="n">xmin2</span><span class="p">,</span><span class="n">xmax2</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span><span class="p">)</span>

<span class="c1">#Convert to data.frame
</span><span class="n">mat</span> <span class="o">=</span> <span class="n">data.frame</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span><span class="n">dates</span><span class="o">=</span><span class="n">index</span><span class="p">(</span><span class="n">mat</span><span class="p">),</span><span class="n">idx</span><span class="o">=</span><span class="m">1</span><span class="o">:</span><span class="n">nrow</span><span class="p">(</span><span class="n">mat</span><span class="p">))</span>

<span class="n">p1</span> <span class="o">=</span> <span class="n">ggplot</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">idx</span><span class="p">))</span><span class="o">+</span>
  <span class="n">geom_line</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">SPCS10RSA</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">cols</span><span class="p">[</span><span class="m">2</span><span class="p">])</span><span class="o">+</span>
  <span class="n">xlab</span><span class="p">(</span><span class="s2">"Time"</span><span class="p">)</span><span class="o">+</span><span class="n">ggtitle</span><span class="p">(</span><span class="s2">"House Price Index"</span><span class="p">)</span><span class="o">+</span>
  <span class="n">geom_rect</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">limits</span><span class="p">,</span>
            <span class="n">aes</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="n">xmin1</span><span class="p">,</span><span class="n">xmax</span><span class="o">=</span><span class="n">xmax1</span><span class="p">,</span><span class="n">ymin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span><span class="o">=</span><span class="n">ymax</span><span class="p">),</span>
            <span class="n">fill</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.2</span><span class="p">,</span><span class="n">inherit.aes</span><span class="o">=</span><span class="n">F</span><span class="p">)</span><span class="o">+</span>
  <span class="n">geom_rect</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">limits</span><span class="p">,</span>
            <span class="n">aes</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="n">xmin2</span><span class="p">,</span><span class="n">xmax</span><span class="o">=</span><span class="n">xmax2</span><span class="p">,</span><span class="n">ymin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span><span class="o">=</span><span class="n">ymax</span><span class="p">),</span>
            <span class="n">fill</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.2</span><span class="p">,</span><span class="n">inherit.aes</span><span class="o">=</span><span class="n">F</span><span class="p">)</span>
  
<span class="n">p2</span> <span class="o">=</span> <span class="n">ggplot</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">idx</span><span class="p">))</span><span class="o">+</span>
  <span class="n">geom_line</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">UNRATE</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">cols</span><span class="p">[</span><span class="m">1</span><span class="p">])</span><span class="o">+</span>
  <span class="n">xlab</span><span class="p">(</span><span class="s2">"Time"</span><span class="p">)</span><span class="o">+</span><span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Unemployment"</span><span class="p">)</span><span class="o">+</span>
  <span class="n">geom_rect</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">limits</span><span class="p">,</span>
            <span class="n">aes</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="n">xmin1</span><span class="p">,</span><span class="n">xmax</span><span class="o">=</span><span class="n">xmax1</span><span class="p">,</span><span class="n">ymin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span><span class="o">=</span><span class="n">ymax</span><span class="p">),</span>
            <span class="n">fill</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.2</span><span class="p">,</span><span class="n">inherit.aes</span><span class="o">=</span><span class="n">F</span><span class="p">)</span><span class="o">+</span>
  <span class="n">geom_rect</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">limits</span><span class="p">,</span>
            <span class="n">aes</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="n">xmin2</span><span class="p">,</span><span class="n">xmax</span><span class="o">=</span><span class="n">xmax2</span><span class="p">,</span><span class="n">ymin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span><span class="o">=</span><span class="n">ymax</span><span class="p">),</span>
            <span class="n">fill</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.2</span><span class="p">,</span><span class="n">inherit.aes</span><span class="o">=</span><span class="n">F</span><span class="p">)</span>

<span class="n">p3</span> <span class="o">=</span> <span class="n">ggplot</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">idx</span><span class="p">))</span><span class="o">+</span>
  <span class="n">geom_line</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">GDPC1</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">cols</span><span class="p">[</span><span class="m">3</span><span class="p">])</span><span class="o">+</span>
  <span class="n">xlab</span><span class="p">(</span><span class="s2">"Time"</span><span class="p">)</span><span class="o">+</span><span class="n">ggtitle</span><span class="p">(</span><span class="s2">"GDP"</span><span class="p">)</span><span class="o">+</span>
  <span class="n">geom_rect</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">limits</span><span class="p">,</span>
            <span class="n">aes</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="n">xmin1</span><span class="p">,</span><span class="n">xmax</span><span class="o">=</span><span class="n">xmax1</span><span class="p">,</span><span class="n">ymin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span><span class="o">=</span><span class="n">ymax</span><span class="p">),</span>
            <span class="n">fill</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.2</span><span class="p">,</span><span class="n">inherit.aes</span><span class="o">=</span><span class="n">F</span><span class="p">)</span><span class="o">+</span>
  <span class="n">geom_rect</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">limits</span><span class="p">,</span>
            <span class="n">aes</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="n">xmin2</span><span class="p">,</span><span class="n">xmax</span><span class="o">=</span><span class="n">xmax2</span><span class="p">,</span><span class="n">ymin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span><span class="o">=</span><span class="n">ymax</span><span class="p">),</span>
            <span class="n">fill</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.2</span><span class="p">,</span><span class="n">inherit.aes</span><span class="o">=</span><span class="n">F</span><span class="p">)</span>

<span class="n">p4</span> <span class="o">=</span> <span class="n">ggplot</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">idx</span><span class="p">))</span><span class="o">+</span>
  <span class="n">geom_line</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">BAA10Y</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">cols</span><span class="p">[</span><span class="m">4</span><span class="p">])</span><span class="o">+</span>
  <span class="n">xlab</span><span class="p">(</span><span class="s2">"Time"</span><span class="p">)</span><span class="o">+</span><span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Interest Rate Spread"</span><span class="p">)</span><span class="o">+</span>
  <span class="n">geom_rect</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">limits</span><span class="p">,</span>
            <span class="n">aes</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="n">xmin1</span><span class="p">,</span><span class="n">xmax</span><span class="o">=</span><span class="n">xmax1</span><span class="p">,</span><span class="n">ymin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span><span class="o">=</span><span class="n">ymax</span><span class="p">),</span>
            <span class="n">fill</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.2</span><span class="p">,</span><span class="n">inherit.aes</span><span class="o">=</span><span class="n">F</span><span class="p">)</span><span class="o">+</span>
  <span class="n">geom_rect</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">limits</span><span class="p">,</span>
            <span class="n">aes</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="n">xmin2</span><span class="p">,</span><span class="n">xmax</span><span class="o">=</span><span class="n">xmax2</span><span class="p">,</span><span class="n">ymin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span><span class="o">=</span><span class="n">ymax</span><span class="p">),</span>
            <span class="n">fill</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.2</span><span class="p">,</span><span class="n">inherit.aes</span><span class="o">=</span><span class="n">F</span><span class="p">)</span>

<span class="n">source</span><span class="p">(</span><span class="s2">"Multiplot.R"</span><span class="p">)</span>
<span class="n">multiplot</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">,</span><span class="n">p3</span><span class="p">,</span><span class="n">p4</span><span class="p">,</span><span class="n">cols</span><span class="o">=</span><span class="m">2</span><span class="p">)</span></code></pre></figure>

<p><img src="/assets/figures/Clustering/unnamed-chunk-10-1.png" title="center" alt="center" style="display: block; margin: auto;" /></p>

<p>Note that code for the function ‘multiplot’ can be found <a href="http://www.cookbook-r.com/Graphs/Multiple_graphs_on_one_page_(ggplot2)/">here</a></p>

<p>I think the plots above speak to how bad the recent recession was. The fact that the 07/08 recession had debt as one of it’s primary drivers is evident in how wide the interest rate spreads were at the time. The extensive use of credit derivatives and securitization helped pushed homeowner-level defaults and losses to big investment banks and other institutional investors only magnifying the effect.</p>

<p>Here are some posts I came across which provide good insight.<br />
http://conversableeconomist.blogspot.com/2011/10/why-didnt-dot-com-crash-hurt-like.html<br />
http://jaredbernsteinblog.com/why-was-the-housing-bubble-so-much-more-damaging-than-the-dot-com-bubble/</p>

<p>Let me know what you think in the comments below…</p>


  <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'royr2'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    
</div>

<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2016/02/18/Data-Table-Tutorial.html">
            A data.table Tutorial
            <small>18 Feb 2016</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2015/12/29/HappyNewYear.html">
            Happy New Year using a Heatmap !?
            <small>29 Dec 2015</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2014/10/20/RChart.html">
            RCharts
            <small>20 Oct 2014</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>

    </div>
<!--Google Analytics--->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-57026003-1', 'auto');
  ga('send', 'pageview');

</script>
  </body>
</html>
